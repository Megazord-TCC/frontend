<div class="strategy-detail-layout">

  <div class="strategy-detail-content">
    <!-- Breadcrumb -->
    <app-breadcrumb></app-breadcrumb>

    <!-- Header -->
    <div class="strategy-header">
      <div class="header-top">
        <button class="back-btn" (click)="goBack()">
          <app-svg-icon
            class="nav-icon"
            [path]="'assets/icon/voltar_vetor.svg'"
            [size]="18">
          </app-svg-icon>
        </button>
        <h1>{{strategy.name}}</h1>
        <app-badge [color]="getStrategyStatusColor(strategy.status)">{{getStrategyStatusLabel(strategy.status)}}</app-badge>
      </div>
      <p class="strategy-description">{{strategy.description}}</p>
      <div class="action-header">
        <div class="action-buttons">
          <button class="action-btn" (click)="editStrategy()">
            Editar
          </button>
          <button class="action-btn" (click)="cancelStrategy()" *ngIf="!isInactive()">
            Cancelar
          </button>
          <button class="action-btn delete" (click)="deleteStrategy()" *ngIf="!isInactive()">
            Excluir
          </button>
          <button class="action-btn" (click)="onActivateStrategy()" *ngIf="isInactive()">
            Ativar estratégia
          </button>
        </div>
      <div class="last-update">
        Última alteração realizada em {{ strategy.lastModifiedAt ? (parseDateString(strategy.lastModifiedAt) | date: 'dd/MM/yyyy HH:mm') : '' }}.
      </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs-list">
        <button
          class="tab-trigger"
          [class.active]="activeTab === 'objetivos'"
          (click)="onTabChange('objetivos')">
          <app-svg-icon
            class="nav-icon"
            [path]="'assets/icon/p_vetor.svg'"
            [size]="18">
          </app-svg-icon>
          <span class="tab-number">1</span>
          Objetivos
        </button>
        <button
          class="tab-trigger"
          [class.active]="activeTab === 'criterios'"
          (click)="onTabChange('criterios')">
          <app-svg-icon
            class="nav-icon"
            [path]="'assets/icon/metrica_vetor.svg'"
            [size]="18">
          </app-svg-icon>
          <span class="tab-number">2</span>
          Grupos de critérios
        </button>
        <button
          class="tab-trigger"
          [class.active]="activeTab === 'avaliacoes'"
          (click)="onTabChange('avaliacoes')">
          <app-svg-icon
            class="nav-icon"
            [path]="'assets/icon/assignment_projetos_vetor.svg'"
            [size]="18">
          </app-svg-icon>
          <span class="tab-number">3</span>
          Grupos de avaliações
        </button>
        <button
          class="tab-trigger"
          [class.active]="activeTab === 'cenarios'"
          (click)="onTabChange('cenarios')">
          <app-svg-icon
            class="nav-icon"
            [path]="'assets/icon/cenarios_vetor.svg'"
            [size]="18">
          </app-svg-icon>
          <span class="tab-number">4</span>
          Cenários
        </button>

      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Objetivos Tab -->
        <div *ngIf="activeTab === 'objetivos'" class="tab-panel">
          <h3>Objetivos estratégicos</h3>
          <p class="tab-description">
            Cadastre os objetivos desta estratégia, os quais são utilizados como base para os critérios de avaliação.
          </p>
          <app-table
            #objectivesTableComponent
           *ngIf="strategy.id"
            [dataRetrievalMethodRef]="getDataForObjetivesTable"
            [filterText]="objectivesFilterText"
            [columns]="objectivesColumns"
            [actionButton]="objectivesActionButton"
            (actionButtonClick)="openCreateModal()"
            (mainColumnRowClick)="openObjectiveModal($event.id)">
          </app-table>
          </div>

        <!-- Grupos de Critérios Tab -->
        <div *ngIf="activeTab === 'criterios'" class="tab-panel">
          <h3>Grupos de critérios</h3>
          <p class="tab-description">
            Cadastre grupos de critérios, utilizados para criar grupos de avaliações.
          </p>
          <!-- Criteria Groups Table -->
          <app-table
            #criteriaTableComponent
            *ngIf="strategy.id"
            [dataRetrievalMethodRef]="getDataForCriteriaGroupsTable"
            [filterButtons]="criteriaFilterButtons"
            [filterText]="criteriaFilterText"
            [columns]="criteriaColumns"
            [actionButton]="criteriaActionButton"
            (actionButtonClick)="openCreateModal()"
            (mainColumnRowClick)="openCriteriaGroup($event)">
          </app-table>

        </div>

        <!-- Grupos de Avaliações Tab -->
        <app-evaluation-groups-tab *ngIf="activeTab === 'avaliacoes'"></app-evaluation-groups-tab>

        <!-- Cenários Tab -->
        <app-scenario-tab *ngIf="activeTab === 'cenarios'"></app-scenario-tab>
      </div>
    </div>
  </div>
  <app-form-modal-component
    [isVisible]="showCreateModal"
    [config]="currentFormConfig"
    (close)="closeCreateModal()"
    (save)="onSaveByActiveTab($event)"
    (cancel)="closeCreateModal()">
  </app-form-modal-component>

  <!-- Modal de Edição -->
  <app-form-modal-component
    [isVisible]="showEditModal"
    [config]="editStrategyConfig"
    (close)="closeEditModal()"
    (save)="onSaveStrategyEdit($event)"
    (cancel)="closeEditModal()">
  </app-form-modal-component>

  <!-- Modal de Cancelamento -->
  <app-form-modal-component
    [isVisible]="showCancelModal"
    [config]="cancelStrategyConfig"
    (close)="closeCancelModal()"
    (save)="onCancelStrategy($event)"
    (cancel)="closeCancelModal()">
  </app-form-modal-component>
</div>
