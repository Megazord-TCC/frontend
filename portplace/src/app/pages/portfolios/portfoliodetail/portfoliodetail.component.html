<div class="portfolio-detail-container">
    <app-portfolio-detail-header></app-portfolio-detail-header>

    <!-- Tabs -->
    <div class="tabs-container">
        <div class="tabs-list">
            <button class="tab-trigger" [class.active]="activeTab === 'resumo'" (click)="onTabChange('resumo')">
                <app-svg-icon class="nav-icon" [path]="'assets/icon/resumo_vetor.svg'" [size]="18">
                </app-svg-icon>
                Resumo
            </button>
            <button class="tab-trigger" [class.active]="activeTab === 'projetos'" (click)="onTabChange('projetos')">
                <app-svg-icon class="nav-icon" [path]="'assets/icon/assignment_projetos_vetor.svg'" [size]="18">
                </app-svg-icon>
                Projetos
            </button>
            <button class="tab-trigger" [class.active]="activeTab === 'riscos'" (click)="onTabChange('riscos')">
                <app-svg-icon class="nav-icon" [path]="'assets/icon/riscos_vetor.svg'" [size]="18">
                </app-svg-icon>
                Riscos
                <app-badge color="red">2</app-badge>
            </button>
            <button class="tab-trigger" [class.active]="activeTab === 'comunicacao'"
                (click)="onTabChange('comunicacao')">
                <app-svg-icon class="nav-icon" [path]="'assets/icon/comunicacao_vetor.svg'" [size]="18">
                </app-svg-icon>
                Comunicação
            </button>
            <button class="tab-trigger" [class.active]="activeTab === 'responsaveis'"
                (click)="onTabChange('responsaveis')">
                <app-svg-icon class="nav-icon" [path]="'assets/icon/user_vetor.svg'" [size]="18">
                </app-svg-icon>
                Responsáveis
            </button>
            <button class="tab-trigger" [class.active]="activeTab === 'categorias'" (click)="onTabChange('categorias')">
                <app-svg-icon class="nav-icon" [path]="'assets/icon/categorias_vetor.svg'" [size]="18">
                </app-svg-icon>
                Categorias
            </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Resumo Tab -->
             <app-portfolio-summary-tab *ngIf="activeTab === 'resumo'" class="tab-panel"></app-portfolio-summary-tab>

            <!-- Projetos Tab -->
            <app-portfolio-projects-tab *ngIf="activeTab === 'projetos'" class="tab-panel"></app-portfolio-projects-tab>

            <!-- Riscos Tab -->
            <div *ngIf="activeTab === 'riscos'" class="tab-panel">
                <h3>Riscos do portfólio</h3>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="filters-left">
                        <button class="btn-primary" (click)="openCreateModal()">
                            <i class="icon-plus">+</i>
                            Cadastrar
                        </button>

                    </div>

                    <div class="actions-right">
                        <div class="search-container">

                            <app-svg-icon class="nav-icon" [path]="'assets/icon/search_vetor.svg'" [size]="18">
                            </app-svg-icon>
                            <input type="text" placeholder="Buscar pelo nome da estratégia" [(ngModel)]="searchTerm"
                                (input)="onSearchChange()">
                        </div>
                    </div>
                </div>

                <!-- Risks Table -->
                <app-card class="table-card">
                    <div class="table-container">
                        <table class="risks-table">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="header-cell">
                                            Código
                                            <i class="icon-sort"></i>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="header-cell">
                                            Nome do risco
                                            <i class="icon-sort"></i>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="header-cell">
                                            Probabilidade
                                            <i class="icon-sort"></i>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="header-cell">
                                            Impacto
                                            <i class="icon-sort"></i>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="header-cell">
                                            Severidade
                                            <i class="icon-sort"></i>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="header-cell">
                                            Ocorrências não resolvidas
                                            <i class="icon-sort"></i>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let risk of risks" class="table-row">
                                    <td>{{risk.code}}</td>
                                    <td>
                                        <button class="risk-link" (click)="openRiskModal(risk)">
                                            {{risk.name}}
                                        </button>
                                    </td>
                                    <td>{{risk.probability}}</td>
                                    <td>{{risk.impact}}</td>
                                    <td>{{risk.severity}}</td>
                                    <td class="text-red">{{risk.unresolvedOccurrences}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </app-card>


            </div>

            <!-- Comunicação Tab -->
            <div *ngIf="activeTab === 'comunicacao'" class="tab-panel">
                <h3>Comunicação no portfólio</h3>

                <!-- Communication Sub-tabs -->
                <div class="communication-tabs">
                    <div class="comm-tabs-list">
                        <button class="comm-tab-trigger" [class.active]="activeCommTab === 'plano'"
                            (click)="onCommTabChange('plano')">
                            Plano de comunicação
                        </button>
                        <button class="comm-tab-trigger" [class.active]="activeCommTab === 'partes'"
                            (click)="onCommTabChange('partes')">
                            Partes interessadas
                        </button>
                        <button class="comm-tab-trigger" [class.active]="activeCommTab === 'armazenamento'"
                            (click)="onCommTabChange('armazenamento')">
                            Armazenamento
                        </button>
                    </div>

                    <!-- Communication Tab Content -->
                    <div class="comm-tab-content">
                        <!-- Plano de comunicação -->
                        <div *ngIf="activeCommTab === 'plano'" class="comm-tab-panel">
                            <div class="comm-actions">
                                <button class="btn-primary">
                                    <i class="icon-plus"></i>
                                    Cadastrar
                                </button>
                                <div class="search-container">
                                    <i class="icon-search"></i>
                                    <input type="text" placeholder="Buscar em todas colunas">
                                </div>
                            </div>

                            <app-card class="table-card">
                                <div class="table-container">
                                    <table class="communication-table">
                                        <thead>
                                            <tr>
                                                <th>
                                                    <div class="header-cell">
                                                        Nome do evento
                                                        <i class="icon-sort"></i>
                                                    </div>
                                                </th>
                                                <th>
                                                    <div class="header-cell">
                                                        Participantes
                                                        <i class="icon-sort"></i>
                                                    </div>
                                                </th>
                                                <th>
                                                    <div class="header-cell">
                                                        Periodicidade
                                                        <i class="icon-sort"></i>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let event of communicationEvents" class="table-row">
                                                <td>
                                                    <button class="event-link">{{event.name}}</button>
                                                </td>
                                                <td>{{event.participants}}</td>
                                                <td>{{event.frequency}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </app-card>
                        </div>

                        <!-- Partes interessadas -->
                        <div *ngIf="activeCommTab === 'partes'" class="comm-tab-panel">
                            <div class="empty-state">
                                <p>Nenhuma parte interessada cadastrada.</p>
                            </div>
                        </div>

                        <!-- Armazenamento -->
                        <div *ngIf="activeCommTab === 'armazenamento'" class="comm-tab-panel">
                            <div class="empty-state">
                                <p>Nenhum documento armazenado.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Responsáveis Tab -->
            <app-portfolio-supervisors-tab *ngIf="activeTab === 'responsaveis'" class="tab-panel"></app-portfolio-supervisors-tab>
            <!-- <div *ngIf="activeTab === 'responsaveis'" class="tab-panel">
                <h3>Usuários responsáveis pelo portfólio</h3>

                <div class="users-actions">
                    <button class="btn-primary">
                        <i class="icon-plus"></i>
                        Cadastrar
                    </button>
                    <div class="search-container">
                        <i class="icon-search"></i>
                        <input type="text" placeholder="Buscar em todas colunas">
                    </div>
                </div>

                <app-card class="table-card">
                    <div class="table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="header-cell">
                                            Nome do usuário
                                            <i class="icon-sort"></i>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let user of responsibleUsers" class="table-row">
                                    <td>
                                        <button class="user-link">{{user.name}}</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </app-card>
            </div> -->

            <!-- Categorias Tab -->
            <app-portfolio-category-tab *ngIf="activeTab === 'categorias'" class="tab-panel"></app-portfolio-category-tab>
        </div>
    </div>

    <!-- Modals -->
    <app-edit-portfolio-modal *ngIf="showEditModal" [portfolio]="portfolio" (close)="closeEditModal()">
    </app-edit-portfolio-modal>

    <app-risk-modal *ngIf="showRiskModal" [risk]="editingRisk" (close)="closeRiskModal()">
    </app-risk-modal>
</div>
