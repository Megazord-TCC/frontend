<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard de portfólio</h1>
  </div>

  <div *ngIf="!hasPortfolio" class="no-portfolio">
    <p>
      Nenhum portfólio em andamento.
      <button class="link-btn" (click)="onHasPortfolioChange()">
        Acesse a página de Portfólios
      </button>
      e realize o cadastro.
    </p>
  </div>

  <div *ngIf="hasPortfolio" class="dashboard-content">
    <!-- Portfolio Selector -->
    <div class="portfolio-selector">

      <span>Portfólio:</span>
      <select [(ngModel)]="selectedPortfolio" (change)="onPortfolioChange(selectedPortfolio)">
        <option value="portfolio1">Portfólio 1</option>
        <option value="portfolio2">Portfólio 2</option>
      </select>
      <button *ngIf="authService.getAuthorizedPageTypesByRole().includes(pageType.PORTFOLIOS)" 
        class="add-portfolio-btn">
        Acessar portfólio
      </button>
    </div>

    <!-- Metrics Cards -->
    <div class="metrics-grid">
      <app-card *ngFor="let card of metricCards" class="metric-card">
        <div class="metric-content">
          <app-svg-icon
            class="nav-icon"
            [path]="card.icon"
            [size]="24">
          </app-svg-icon>
          <div class="metric-info-container">
            <div class="metric-title-row">
              <p class="metric-title">{{card.title}}</p>
              <div class="metric-indicator" [class]="'indicator-' + card.color" *ngIf="card.color !== 'none'"></div>
            </div>
            <p class="metric-subtitle">{{card.subtitle}}</p>
          </div>
        </div>
      </app-card>
    </div>

    <!-- Expandable Sections -->
    <app-card class="expandable-section">
      <button class="section-header" (click)="toggleSection('progress')">
        <div class="section-title" [class.expanded]="isSectionExpanded('progress')">
          <app-svg-icon
            class="nav-icon"
            [path]="isSectionExpanded('progress') ? 'assets/icon/setaBaixo_vetor.svg' : 'assets/icon/seta_vetor.svg'"
            [size]="14">
          </app-svg-icon>
          <span>Progresso do portfólio (50%)</span>
        </div>
      </button>
      <div class="section-content" *ngIf="isSectionExpanded('progress')">
        <div class="progress-item">
          <span>Projeto 1 (50%)</span>
          <app-progress class="progess" [value]="80"></app-progress>
        </div>
        <div class="progress-item">
          <span>Projeto 2 (50%)</span>
          <app-progress [value]="50"></app-progress>
        </div>
        <div class="progress-item">
          <span>Projeto 3 (50%)</span>
          <app-progress [value]="50"></app-progress>
        </div>
      </div>
    </app-card>

    <!-- Risk Tracking -->
    <app-card class="expandable-section">
      <button class="section-header" (click)="toggleSection('risks')">
        <div class="section-title" [class.expanded]="isSectionExpanded('risks')">
          <app-svg-icon
            class="nav-icon"
            [path]="isSectionExpanded('risks') ? 'assets/icon/setaBaixo_vetor.svg' : 'assets/icon/seta_vetor.svg'"
            [size]="14">
          </app-svg-icon>
          <span>Acompanhamento dos 3 maiores riscos</span>
          <app-badge class="risk-badge">4 ocorrências</app-badge>
        </div>
      </button>
      <div class="section-content" *ngIf="isSectionExpanded('risks')">
        <div class="table-container">
          <table class="risks-table">
            <thead>
              <tr>
                <th>Código</th>
                <th>Risco</th>
                <th>Probabilidade</th>
                <th>Impacto</th>
                <th>Severidade</th>
                <th>Ocorrências resolvidas</th>
                <th>Ocorrências não resolvidas</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let risk of risks">
                <td>{{risk.code}}</td>
                <td class="risk-name">{{risk.name}}</td>
                <td>{{risk.probability}}</td>
                <td>{{risk.impact}}</td>
                <td>{{risk.severity}}</td>
                <td [class.text-red]="risk.resolvedOccurrences > 3">{{risk.resolvedOccurrences}}</td>
                <td [class.text-red]="risk.unresolvedOccurrences > 1">{{risk.unresolvedOccurrences}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </app-card>

    <!-- Objectives -->
    <app-card class="expandable-section">
      <button class="section-header" (click)="toggleSection('objectives')">
        <div class="section-title" [class.expanded]="isSectionExpanded('objectives')">
          <app-svg-icon
            class="nav-icon"
            [path]="isSectionExpanded('objectives') ? 'assets/icon/setaBaixo_vetor.svg' : 'assets/icon/seta_vetor.svg'"
            [size]="14">
          </app-svg-icon>
          <span>Objetivos</span>
        </div>
      </button>
      <div class="section-content" *ngIf="isSectionExpanded('objectives')">
        <div class="objectives-list">
          <div class="objective-item" *ngFor="let objective of objectives">
            <app-svg-icon
              class="nav-icon"
              [path]="'assets/icon/p_vetor.svg'"
              [size]="18">
            </app-svg-icon>
            <div class="objective-info">
              <p class="objective-name">{{objective.name}}</p>
              <p class="objective-description">{{objective.description}}</p>
            </div>
          </div>
        </div>
      </div>
    </app-card>

    <div class="charts-grid">
      <app-card class="chart-card">
        <h3>Custo por Trimestre</h3>
        <div class="chart-container">
          <canvas #costChart></canvas>
        </div>
      </app-card>

      <app-card class="chart-card">
        <h3>Projetos: Payback vs Alinhamento Estratégico</h3>
        <div class="chart-container">
          <canvas #projectBubbleChart></canvas>
        </div>
        <div class="chart-description">
          <p>O tamanho da bolha representa o valor do projeto. Eixo X: Payback em meses, Eixo Y: Alinhamento estratégico (1-10).</p>
        </div>
      </app-card>

      <app-card class="chart-card">
        <h3>Riscos: Impacto vs Probabilidade</h3>
        <div class="chart-container">
          <canvas #riskBubbleChart></canvas>
        </div>
        <div class="chart-description">
          <p>O tamanho da bolha representa a severidade do risco. Eixo X: Probabilidade (1-5), Eixo Y: Impacto (1-5).</p>
        </div>
      </app-card>
    </div>
  </div>
</div>
