<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard de portfólio</h1>
  </div>

  <div *ngIf="!hasPortfolio" class="no-portfolio">
    <p>
      Nenhum portfólio em andamento.
      <button class="link-btn" (click)="hasPortfolio = true">
        Acesse a página de Portfólios
      </button>
      e realize o cadastro.
    </p>
  </div>

  <div *ngIf="hasPortfolio" class="dashboard-content">
    <!-- Portfolio Selector -->
    <div class="portfolio-selector">
      <span>Portfólio:</span>
      <select [(ngModel)]="selectedPortfolio" (change)="onPortfolioChange(selectedPortfolio)">
        <option value="portfolio1">Portfólio 1</option>
        <option value="portfolio2">Portfólio 2</option>
      </select>
      <button class="add-portfolio-btn">Adicionar portfólio</button>
    </div>

    <!-- Metrics Cards -->
    <div class="metrics-grid">
      <app-card *ngFor="let card of metricCards" class="metric-card">
        <div class="metric-content">
          <div class="metric-indicator" [class]="'indicator-' + card.color" *ngIf="card.color !== 'none'"></div>
          <div class="metric-info">
            <p class="metric-title">{{card.title}}</p>
            <p class="metric-subtitle">{{card.subtitle}}</p>
          </div>
        </div>
      </app-card>
    </div>

    <!-- Expandable Sections -->
    <app-card class="expandable-section">
      <button class="section-header" (click)="toggleSection('progress')">
        <div class="section-title">
          <i class="chevron-icon" [class.expanded]="isSectionExpanded('progress')"></i>
          <span>Progresso do portfólio (50%)</span>
        </div>
      </button>
      <div class="section-content" *ngIf="isSectionExpanded('progress')">
        <div class="progress-item">
          <span>Projeto 1 (50%)</span>
          <app-progress [value]="50"></app-progress>
        </div>
        <div class="progress-item">
          <span>Projeto 2 (50%)</span>
          <app-progress [value]="50"></app-progress>
        </div>
        <div class="progress-item">
          <span>Projeto 3 (50%)</span>
          <app-progress [value]="50"></app-progress>
        </div>
      </div>
    </app-card>

    <!-- Risk Tracking -->
    <app-card class="expandable-section">
      <button class="section-header" (click)="toggleSection('risks')">
        <div class="section-title">
          <i class="chevron-icon" [class.expanded]="isSectionExpanded('risks')"></i>
          <span>Acompanhamento dos 3 maiores riscos</span>
          <app-badge class="risk-badge">4 ocorrências</app-badge>
        </div>
      </button>
      <div class="section-content" *ngIf="isSectionExpanded('risks')">
        <div class="table-container">
          <table class="risks-table">
            <thead>
              <tr>
                <th>Código</th>
                <th>Risco</th>
                <th>Probabilidade</th>
                <th>Impacto</th>
                <th>Severidade</th>
                <th>Ocorrências resolvidas</th>
                <th>Ocorrências não resolvidas</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let risk of risks">
                <td>{{risk.code}}</td>
                <td class="risk-name">{{risk.name}}</td>
                <td>{{risk.probability}}</td>
                <td>{{risk.impact}}</td>
                <td>{{risk.severity}}</td>
                <td [class.text-red]="risk.resolvedOccurrences > 3">{{risk.resolvedOccurrences}}</td>
                <td [class.text-red]="risk.unresolvedOccurrences > 1">{{risk.unresolvedOccurrences}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </app-card>

    <!-- Objectives -->
    <app-card class="expandable-section">
      <button class="section-header" (click)="toggleSection('objectives')">
        <div class="section-title">
          <i class="chevron-icon" [class.expanded]="isSectionExpanded('objectives')"></i>
          <span>Objetivos</span>
        </div>
      </button>
      <div class="section-content" *ngIf="isSectionExpanded('objectives')">
        <div class="objectives-list">
          <div class="objective-item" *ngFor="let objective of objectives">
            <div class="objective-checkbox"></div>
            <div class="objective-info">
              <p class="objective-name">{{objective.name}}</p>
              <p class="objective-description">{{objective.description}}</p>
            </div>
          </div>
        </div>
      </div>
    </app-card>

    <!-- Charts -->
    <div class="charts-grid">
      <!-- Cost Chart -->
      <app-card class="chart-card">
        <h3>Custo</h3>
        <div class="chart-container">
          <div class="bar-chart">
            <div class="quarter-group">
              <div class="bars">
                <div class="bar planned" style="height: 64px;"></div>
                <div class="bar actual" style="height: 48px;"></div>
              </div>
              <span class="quarter-label">Q1</span>
            </div>
            <div class="quarter-group">
              <div class="bars">
                <div class="bar planned" style="height: 48px;"></div>
                <div class="bar actual" style="height: 80px;"></div>
              </div>
              <span class="quarter-label">Q2</span>
            </div>
            <div class="quarter-group">
              <div class="bars">
                <div class="bar planned" style="height: 32px;"></div>
                <div class="bar actual" style="height: 32px;"></div>
              </div>
              <span class="quarter-label">Q3</span>
            </div>
            <div class="quarter-group">
              <div class="bars">
                <div class="bar planned" style="height: 64px;"></div>
                <div class="bar actual" style="height: 48px;"></div>
              </div>
              <span class="quarter-label">Q4</span>
            </div>
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <div class="legend-color planned"></div>
              <span>Custo planejado (R$)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color actual"></div>
              <span>Custo real (R$)</span>
            </div>
          </div>
        </div>
      </app-card>

      <!-- Bubble Chart -->
      <app-card class="chart-card">
        <h3>Três riscos com maior severidade</h3>
        <div class="bubble-chart-container">
          <div class="bubble-chart">
            <!-- Y-axis labels -->
            <div class="y-axis">
              <span>3</span>
              <span>2</span>
              <span>1</span>
              <span>0</span>
            </div>

            <!-- Chart area -->
            <div class="chart-area">
              <!-- Risco 3 -->
              <div class="bubble small red" style="left: 15%; bottom: 40%;">
                <span>3</span>
                <div class="bubble-label">Risco 3</div>
              </div>

              <!-- Risco 8 -->
              <div class="bubble medium green" style="left: 50%; bottom: 65%;">
                <span>8</span>
                <div class="bubble-label">Risco 8</div>
              </div>

              <!-- Risco 6 -->
              <div class="bubble large blue" style="left: 75%; bottom: 65%;">
                <span>6</span>
                <div class="bubble-label">Risco 6</div>
              </div>
            </div>

            <!-- X-axis labels -->
            <div class="x-axis">
              <span>1</span>
              <span>2</span>
              <span>3</span>
              <span>4</span>
            </div>
          </div>

          <!-- Axis labels -->
          <div class="axis-labels">
            <div class="y-label">Impacto</div>
            <div class="x-label">Probabilidade</div>
          </div>

          <div class="chart-description">
            <p>O tamanho da bolha indica a severidade.</p>
          </div>
        </div>
      </app-card>
    </div>
  </div>
</div>
